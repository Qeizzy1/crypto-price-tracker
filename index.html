<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VexApi - Live Crypto Tracker</title>
<style>
  body {
    background: #121720;
    color: #a0d8f7;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    margin: 20px;
  }
  #loading-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #112133;
    border-top: 5px solid #00ffe7;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 30px auto;
  }
  @keyframes spin {
    0% { transform: rotate(0deg);}
    100% { transform: rotate(360deg);}
  }
  #search {
    width: 300px;
    padding: 8px;
    margin-bottom: 15px;
    border-radius: 12px;
    border: none;
    background: #112133;
    color: #6bf3ff;
    font-size: 1rem;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    padding: 12px 10px;
    text-align: left;
    border-bottom: 1px solid #263544;
  }
  th {
    cursor: pointer;
    user-select: none;
  }
  th:hover {
    color: #00ffe7;
  }
  .price-up {
    color: #33ff99;
  }
  .price-down {
    color: #ff3366;
  }
  a.coin-link {
    color: #00bfff;
    text-decoration: none;
    font-weight: 600;
  }
  a.coin-link:hover {
    text-decoration: underline;
  }
  .pagination {
    margin-top: 15px;
    text-align: center;
  }
  .pagination button {
    margin: 0 5px;
    padding: 6px 12px;
    border-radius: 8px;
    border: none;
    background: #263544cc;
    color: #80e8ffcc;
    cursor: pointer;
    font-weight: 700;
  }
  .pagination button:hover {
    background: #1c2a3bdd;
    color: #00f4ff;
  }
  .pagination button:disabled {
    background: #444c5c;
    color: #677e96;
    cursor: not-allowed;
  }
</style>
</head>
<body>

<h1>VexApi - Live Crypto Tracker</h1>

<input type="text" id="search" placeholder="Search coins by name or symbol..." />

<div id="loading-spinner"></div>

<table id="coins-table" style="display:none;">
  <thead>
    <tr>
      <th data-key="name">Name</th>
      <th data-key="symbol">Symbol</th>
      <th data-key="current_price">Price (USD)</th>
      <th data-key="price_change_percentage_24h">24h Change %</th>
      <th data-key="market_cap">Market Cap</th>
      <th>Link</th>
    </tr>
  </thead>
  <tbody id="coin-tbody"></tbody>
</table>

<div class="pagination" id="pagination"></div>

<script>
  const spinner = document.getElementById('loading-spinner');
  const table = document.getElementById('coins-table');
  const tbody = document.getElementById('coin-tbody');
  const searchInput = document.getElementById('search');
  const pagination = document.getElementById('pagination');

  let coins = [];
  let filteredCoins = [];
  let currentPage = 1;
  const coinsPerPage = 20;
  let currentSort = { key: 'market_cap', order: 'desc' };

  async function fetchCoins() {
    try {
      const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=250&page=1&price_change_percentage=24h');
      const data = await response.json();
      return data;
    } catch (error) {
      alert('Failed to fetch coin data.');
      console.error(error);
      return [];
    }
  }

  function renderTable(coinsToRender) {
    tbody.innerHTML = '';
    if(coinsToRender.length === 0){
      tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">No coins found.</td></tr>';
      return;
    }
    for(const coin of coinsToRender){
      const changeClass = coin.price_change_percentage_24h > 0 ? 'price-up' : (coin.price_change_percentage_24h < 0 ? 'price-down' : '');
      const coinLink = `https://dexscreener.com/ethereum/${coin.id}`;
      tbody.innerHTML += `
        <tr>
          <td>${coin.name}</td>
          <td>${coin.symbol.toUpperCase()}</td>
          <td>$${coin.current_price.toFixed(5)}</td>
          <td class="${changeClass}">${coin.price_change_percentage_24h?.toFixed(2) ?? '0.00'}%</td>
          <td>$${coin.market_cap.toLocaleString()}</td>
          <td><a href="${coinLink}" target="_blank" class="coin-link">Dexscreener</a></td>
        </tr>
      `;
    }
  }

  function paginate(coinsArr, page, perPage) {
    const start = (page -1) * perPage;
    return coinsArr.slice(start, start + perPage);
  }

  function renderPagination(totalCoins, perPage, currentPage){
    const totalPages = Math.ceil(totalCoins / perPage);
    pagination.innerHTML = '';

    function createBtn(label, page, disabled = false){
      const btn = document.createElement('button');
      btn.textContent = label;
      btn.disabled = disabled;
      btn.addEventListener('click', () => {
        currentPage = page;
        updateDisplay();
      });
      return btn;
    }

    pagination.appendChild(createBtn('First', 1, currentPage === 1));
    pagination.appendChild(createBtn('Prev', currentPage - 1, currentPage === 1));

    // show max 5 page buttons
    let startPage = Math.max(1, currentPage - 2);
    let endPage = Math.min(totalPages, currentPage + 2);

    if(currentPage <= 3) endPage = Math.min(5, totalPages);
    if(currentPage >= totalPages - 2) startPage = Math.max(1, totalPages - 4);

    for(let i = startPage; i <= endPage; i++){
      const btn = createBtn(i, i, i === currentPage);
      if(i === currentPage) btn.style.fontWeight = 'bold';
      pagination.appendChild(btn);
    }

    pagination.appendChild(createBtn('Next', currentPage + 1, currentPage === totalPages));
    pagination.appendChild(createBtn('Last', totalPages, currentPage === totalPages));
  }

  function sortCoins(coinsArr, key, order){
    return coinsArr.slice().sort((a,b) => {
      let valA = a[key];
      let valB = b[key];

      // Special cases
      if(key === 'name' || key === 'symbol'){
        valA = valA.toLowerCase();
        valB = valB.toLowerCase();
      }
      if(valA === null || valA === undefined) return 1;
      if(valB === null || valB === undefined) return -1;

      if(valA > valB) return order === 'asc' ? 1 : -1;
      if(valA < valB) return order === 'asc' ? -1 : 1;
      return 0;
    });
  }

  function updateDisplay(){
    let displayCoins = coins;

    const searchTerm = searchInput.value.toLowerCase();
    if(searchTerm){
      displayCoins = displayCoins.filter(c => 
        c.name.toLowerCase().includes(searchTerm) || c.symbol.toLowerCase().includes(searchTerm)
      );
    }

    displayCoins = sortCoins(displayCoins, currentSort.key, currentSort.order);

    renderPagination(displayCoins.length, coinsPerPage, currentPage);
    const pageCoins = paginate(displayCoins, currentPage, coinsPerPage);
    renderTable(pageCoins);
  }

  document.querySelectorAll('th[data-key]').forEach(th => {
    th.addEventListener('click', () => {
      const key = th.dataset.key;
      if(currentSort.key === key){
        currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
      } else {
        currentSort.key = key;
        currentSort.order = 'asc';
      }
      currentPage = 1;
      updateDisplay();
    });
  });

  searchInput.addEventListener('input', () => {
    currentPage = 1;
    updateDisplay();
  });

  async function init() {
    spinner.style.display = 'block';
    table.style.display = 'none';

    coins = await fetchCoins();

    spinner.style.display = 'none';
    table.style.display = 'table';

    updateDisplay();
  }

  init();
</script>

</body>
</html>
