<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VexApi - Pulse Tracker</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #0a0f1c;
      color: #ffffff;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 20px;
    }

    header h1 {
      font-size: 2rem;
      color: #ff3f3f;
    }

    .search-container {
      text-align: center;
      margin: 15px 0;
    }

    input[type="text"] {
      padding: 10px;
      border-radius: 8px;
      border: none;
      width: 250px;
      font-size: 1rem;
      background: #1b2233;
      color: white;
    }

    .tabs {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .tab {
      background-color: #1b2233;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      color: #fff;
    }

    .tab.active {
      background-color: #2f3548;
      color: #61dafb;
    }

    .columns {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .column {
      flex: 1;
      min-width: 300px;
      background-color: #121826;
      padding: 15px;
      border-radius: 10px;
    }

    .column h2 {
      font-size: 1.3rem;
      margin-bottom: 10px;
      border-bottom: 2px solid #2c2f42;
      padding-bottom: 5px;
      color: #61dafb;
    }

    .coin {
      background-color: #1e2538;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .coin:hover {
      background-color: #2a3148;
    }

    .coin-info {
      display: flex;
      flex-direction: column;
    }

    .coin-name {
      font-size: 1rem;
      font-weight: bold;
    }

    .coin-price {
      font-size: 0.9rem;
    }

    .price-up { color: #00ff87; }
    .price-down { color: #ff4e4e; }

    .coin-actions a {
      background-color: #2f3548;
      padding: 6px 10px;
      border-radius: 5px;
      color: #61dafb;
      text-decoration: none;
      font-size: 0.85rem;
    }

    .coin-actions a:hover {
      background-color: #3a4157;
    }

    @media (max-width: 900px) {
      .columns { flex-direction: column; }
    }
  </style>
</head>
<body>
  <header>
    <h1>VexApi Pulse</h1>
    <p>Live Crypto Tracker - Updated Every 15s</p>
  </header>

  <div class="search-container">
    <input type="text" id="search" placeholder="Search coins..." oninput="handleSearch()" />
  </div>

  <div class="tabs">
    <div class="tab active" onclick="setTab('main')">Main</div>
    <div class="tab" onclick="setTab('trending')">Trending</div>
  </div>

  <div id="main-view" class="columns">
    <div class="column" id="new-coins">
      <h2>üÜï New Coins</h2>
    </div>
    <div class="column" id="final-stretch">
      <h2>üöÄ Final Stretch</h2>
    </div>
    <div class="column" id="migrated">
      <h2>üíé Migrated</h2>
    </div>
  </div>

  <div id="trending-view" class="columns" style="display:none;">
    <div class="column" id="trending-coins">
      <h2>üî• Trending Coins</h2>
    </div>
  </div>

  <script>
    let coinData = [];

    async function fetchCoinlore() {
      const res = await fetch("https://api.coinlore.net/api/tickers/?start=0&limit=100");
      const data = await res.json();
      return data.data.map(coin => ({
        name: coin.name,
        symbol: coin.symbol,
        price: parseFloat(coin.price_usd),
        change: parseFloat(coin.percent_change_24h),
        link: `https://dexscreener.com/search/${coin.symbol}`
      }));
    }

    async function fetchPumpFun() {
      try {
        const res = await fetch("https://api.pumpfunapi.org/pumpfun/new/tokens");
        const data = await res.json();
        return data.map(c => ({
          name: c.name || c.symbol,
          symbol: c.symbol,
          price: null,
          change: null,
          link: `https://dexscreener.com/search/${c.symbol}`
        }));
      } catch {
        return [];
      }
    }

    function setTab(tab) {
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      if (tab === "main") {
        document.getElementById("main-view").style.display = "flex";
        document.getElementById("trending-view").style.display = "none";
        document.querySelector(".tab:nth-child(1)").classList.add("active");
      } else {
        document.getElementById("main-view").style.display = "none";
        document.getElementById("trending-view").style.display = "flex";
        document.querySelector(".tab:nth-child(2)").classList.add("active");
        displayTrending();
      }
    }

    function displayTrending() {
      const container = document.getElementById("trending-coins");
      container.innerHTML = `<h2>üî• Trending Coins</h2>`;
      const trending = coinData
        .filter(c => c.change !== null && c.change > 0)
        .sort((a, b) => b.change - a.change)
        .slice(0, 15);
      trending.forEach(c => container.appendChild(createCoinCard(c)));
    }

    function createCoinCard(c) {
      const div = document.createElement("div");
      div.className = "coin";
      div.innerHTML = `
        <div class="coin-info">
          <div class="coin-name">${c.name} (${c.symbol})</div>
          <div class="coin-price">
            ${
              c.price !== null
                ? `$${c.price.toFixed(4)} <span class="${
                    c.change > 0 ? "price-up" : c.change < 0 ? "price-down" : ""
                  }">${c.change > 0 ? "üîº" : "üîª"}${c.change.toFixed(2)}%</span>`
                : "No data"
            }
          </div>
        </div>
        <div class="coin-actions">
          <a href="${c.link}" target="_blank">View</a>
        </div>
      `;
      return div;
    }

    function displayCoins() {
      document.getElementById("new-coins").innerHTML = "<h2>üÜï New Coins</h2>";
      document.getElementById("final-stretch").innerHTML = "<h2>üöÄ Final Stretch</h2>";
      document.getElementById("migrated").innerHTML = "<h2>üíé Migrated</h2>";

      const newCoins = coinData.filter(c => c.price === null).slice(0, 15);
      const final = coinData.filter(c => c.change !== null && c.change > 5).slice(0, 15);
      const migrated = coinData.filter(c => c.price && c.price * 1000000 > 50000).slice(0, 15);

      newCoins.forEach(c => document.getElementById("new-coins").appendChild(createCoinCard(c)));
      final.forEach(c => document.getElementById("final-stretch").appendChild(createCoinCard(c)));
      migrated.forEach(c => document.getElementById("migrated").appendChild(createCoinCard(c)));
    }

    function handleSearch() {
      const term = document.getElementById("search").value.toLowerCase();
      if (term === "") {
        displayCoins();
        return;
      }
      const filtered = coinData.filter(c =>
        `${c.name} ${c.symbol}`.toLowerCase().includes(term)
      );

      document.getElementById("new-coins").innerHTML = "<h2>üîç Search Results</h2>";
      document.getElementById("final-stretch").innerHTML = "";
      document.getElementById("migrated").innerHTML = "";
      filtered.forEach(c =>
        document.getElementById("new-coins").appendChild(createCoinCard(c))
      );
    }

    async function update() {
      const pump = await fetchPumpFun();
      const lore = await fetchCoinlore();
      coinData = [...pump, ...lore];
      displayCoins();
    }

    update();
    setInterval(update, 15000);
  </script>
</body>
</html>
