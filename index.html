<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VexApi Pro - Crypto Tracker</title>
<style>
  body {
    background: #121720;
    color: #a0d8f7;
    padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
  }
  h1 {
    color: #38c7ff;
    margin-bottom: 15px;
    text-align: center;
    text-shadow: 0 0 8px #1de9b6, 0 0 16px #38c7ff;
  }
  #search-container {
    text-align: center;
    margin-bottom: 10px;
  }
  input[type="text"] {
    background: #112133;
    border: none;
    border-radius: 12px;
    color: #6bf3ff;
    padding: 10px 14px;
    font-size: 1rem;
    width: 300px;
  }
  input[type="text"]:focus {
    outline: none;
    box-shadow: 0 0 12px #00ffe7cc;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 0 25px #00ffe7aa;
  }
  thead {
    background: #0f1829;
  }
  th, td {
    padding: 12px 15px;
    text-align: left;
    font-size: 1rem;
    color: #a0d8f7;
  }
  tr:nth-child(even) {
    background: #0b1220;
  }
  tr:hover {
    background: #112933dd;
  }
  .price-up {
    color: #33ff99;
    text-shadow: 0 0 6px #33ff99aa;
  }
  .price-down {
    color: #ff3366;
    text-shadow: 0 0 6px #ff3366aa;
  }
  a.coin-link {
    color: #00bfff;
    font-weight: 700;
    text-decoration: none;
  }
  a.coin-link:hover {
    text-decoration: underline;
  }
  .pagination {
    margin-top: 15px;
    text-align: center;
    user-select: none;
  }
  .pagination button {
    margin: 0 5px;
    padding: 8px 14px;
    border-radius: 12px;
    border: none;
    background: #263544cc;
    color: #80e8ffcc;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.3s;
  }
  .pagination button:hover {
    background: #1c2a3bdd;
    color: #00f4ff;
  }
  .pagination button:disabled {
    background: #444c5c;
    color: #677e96;
    cursor: not-allowed;
  }
</style>
</head>
<body>

<h1>VexApi Pro - Crypto Tracker</h1>

<div id="search-container">
  <input type="text" id="search" placeholder="Search coins by name or symbol..." autocomplete="off" />
</div>

<table id="coins-table" style="display:none;">
  <thead>
    <tr>
      <th data-key="name">Name</th>
      <th data-key="symbol">Symbol</th>
      <th data-key="current_price">Price (USD)</th>
      <th data-key="price_change_percentage_24h">24h Change %</th>
      <th data-key="market_cap">Market Cap</th>
      <th>Link</th>
    </tr>
  </thead>
  <tbody id="coin-tbody"></tbody>
</table>

<div class="pagination" id="pagination"></div>

<div id="loading-spinner" style="width:50px;height:50px;border:5px solid #112133;border-top:5px solid #00ffe7;border-radius:50%;animation:spin 1s linear infinite;margin:40px auto;"></div>

<style>
@keyframes spin {
  0% { transform: rotate(0deg);}
  100% { transform: rotate(360deg);}
}
</style>

<script>
(() => {
  const spinner = document.getElementById('loading-spinner');
  const table = document.getElementById('coins-table');
  const tbody = document.getElementById('coin-tbody');
  const searchInput = document.getElementById('search');
  const pagination = document.getElementById('pagination');

  let coins = [];
  let filteredCoins = [];
  let currentPage = 1;
  const coinsPerPage = 30;
  let currentSort = { key: 'market_cap', order: 'desc' };

  async function fetchCoins() {
    spinner.style.display = 'block';
    table.style.display = 'none';
    try {
      const response = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=250&page=1&sparkline=false`);
      coins = await response.json();
      applyFiltersAndSort();
    } catch (e) {
      alert('Error fetching coin data, please try again later.');
      console.error(e);
    }
    spinner.style.display = 'none';
  }

  function applyFiltersAndSort() {
    const searchTerm = searchInput.value.toLowerCase().trim();
    filteredCoins = coins.filter(c => c.name.toLowerCase().includes(searchTerm) || c.symbol.toLowerCase().includes(searchTerm));
    filteredCoins.sort((a,b) => {
      let valA = a[currentSort.key];
      let valB = b[currentSort.key];
      if(currentSort.key === 'name') {
        valA = valA.toLowerCase();
        valB = valB.toLowerCase();
        if(valA < valB) return currentSort.order === 'asc' ? -1 : 1;
        if(valA > valB) return currentSort.order === 'asc' ? 1 : -1;
        return 0;
      }
      if(valA === null || valA === undefined) return 1;
      if(valB === null || valB === undefined) return -1;
      if(currentSort.order === 'asc') return valA - valB;
      else return valB - valA;
    });
    currentPage = 1;
    renderTable();
    renderPagination();
  }

  function renderTable() {
    if(filteredCoins.length === 0) {
      tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; color:#55aaff;">No coins found.</td></tr>`;
      table.style.display = 'table';
      return;
    }
    const start = (currentPage -1) * coinsPerPage;
    const end = start + coinsPerPage;
    const pageCoins = filteredCoins.slice(start, end);
    tbody.innerHTML = '';
    for(const coin of pageCoins) {
      const tr = document.createElement('tr');

      const nameTd = document.createElement('td');
      nameTd.innerHTML = `<img src="${coin.image}" alt="${coin.name}" style="width:20px; height:20px; vertical-align:middle; margin-right:8px; border-radius:50%;"> ${coin.name}`;
      tr.appendChild(nameTd);

      const symTd = document.createElement('td');
      symTd.textContent = coin.symbol.toUpperCase();
      tr.appendChild(symTd);

      const priceTd = document.createElement('td');
      priceTd.textContent = coin.current_price !== null ? `$${coin.current_price.toLocaleString()}` : 'N/A';
      tr.appendChild(priceTd);

      const changeTd = document.createElement('td');
      const change = coin.price_change_percentage_24h;
      changeTd.textContent = change !== null ? change.toFixed(2) + '%' : 'N/A';
      if(change !== null) {
        changeTd.classList.add(change >= 0 ? 'price-up' : 'price-down');
      }
      tr.appendChild(changeTd);

      const capTd = document.createElement('td');
      capTd.textContent = coin.market_cap !== null ? `$${coin.market_cap.toLocaleString()}` : 'N/A';
      tr.appendChild(capTd);

      const linkTd = document.createElement('td');
      const linkA = document.createElement('a');
      // Dexscreener link format: https://dexscreener.com/ethereum/symbol-usd
      // Using symbol lowercase; note this is a heuristic, might not always work perfectly.
      linkA.href = `https://dexscreener.com/ethereum/${coin.symbol.toLowerCase()}-usd`;
      linkA.target = '_blank';
      linkA.rel = 'noopener noreferrer';
      linkA.textContent = 'Dexscreener';
      linkA.classList.add('coin-link');
      linkTd.appendChild(linkA);
      tr.appendChild(linkTd);

      tbody.appendChild(tr);
    }
    table.style.display = 'table';
  }

  function renderPagination() {
    pagination.innerHTML = '';
    const totalPages = Math.ceil(filteredCoins.length / coinsPerPage);
    if(totalPages <= 1) return;

    const createBtn = (text, disabled, onClick) => {
      const btn = document.createElement('button');
      btn.textContent = text;
      btn.disabled = disabled;
      btn.addEventListener('click', onClick);
      return btn;
    };

    pagination.appendChild(createBtn('<<', currentPage === 1, () => { currentPage = 1; renderTable(); renderPagination(); }));
    pagination.appendChild(createBtn('<', currentPage === 1, () => { currentPage--; renderTable(); renderPagination(); }));

    const pageRange = 3;
    let startPage = Math.max(1, currentPage - pageRange);
    let endPage = Math.min(totalPages, currentPage + pageRange);

    if(currentPage <= pageRange) {
      endPage = Math.min(totalPages, 1 + pageRange * 2);
    }
    if(currentPage + pageRange > totalPages) {
      startPage = Math.max(1, totalPages - pageRange * 2);
    }

    for(let i = startPage; i <= endPage; i++) {
      const btn = createBtn(i, false, () => {
        currentPage = i;
        renderTable();
        renderPagination();
      });
      if(i === currentPage) {
        btn.style.background = '#00ffe7';
        btn.style.color = '#012b3d';
        btn.style.cursor = 'default';
      }
      pagination.appendChild(btn);
    }

    pagination.appendChild(createBtn('>', currentPage === totalPages, () => { currentPage++; renderTable(); renderPagination(); }));
    pagination.appendChild(createBtn('>>', currentPage === totalPages, () => { currentPage = totalPages; renderTable(); renderPagination(); }));
  }

  // Sort by clicking header
  document.querySelectorAll('th[data-key]').forEach(th => {
    th.addEventListener('click', () => {
      const key = th.dataset.key;
      if(currentSort.key === key) {
        currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
      } else {
        currentSort.key = key;
        currentSort.order = 'asc';
      }
      applyFiltersAndSort();
    });
  });

  // Search debounce
  let searchTimeout = null;
  searchInput.addEventListener('input', () => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      applyFiltersAndSort();
    }, 300);
  });

  // Initial fetch
  fetchCoins();
})();
</script>

</body>
</html>
