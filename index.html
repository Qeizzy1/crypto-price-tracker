<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dexscreener Clone - Live Data & Interactive</title>
  <style>
    /* Reset & base */
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0; padding: 0;
      height: 100%;
      font-family: "Inter", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #0d1117;
      color: #c9d1d9;
      user-select: none;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    #app {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    /* Sidebar */
    .sidebar {
      width: 280px;
      background-color: #161b22;
      border-right: 1px solid #21262d;
      display: flex;
      flex-direction: column;
      padding: 1rem 0;
      user-select:none;
    }
    .sidebar h2 {
      color: #58a6ff;
      font-weight: 700;
      margin: 0 1.5rem 1rem 1.5rem;
      font-size: 1.5rem;
      letter-spacing: 0.03em;
    }
    .sidebar .section {
      margin-bottom: 1.5rem;
    }
    .sidebar .section-title {
      padding: 0 1.5rem;
      font-weight: 600;
      font-size: 0.75rem;
      color: #8b949e;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .sidebar a {
      display: block;
      padding: 0.5rem 1.5rem;
      font-size: 1rem;
      color: #8b949e;
      text-decoration: none;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .sidebar a:hover,
    .sidebar a.active {
      background-color: #21262d;
      color: #58a6ff;
    }

    /* Main content */
    .main-content {
      flex-grow: 1;
      background-color: #0d1117;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .header {
      padding: 1rem 2rem;
      border-bottom: 1px solid #21262d;
      font-weight: 700;
      font-size: 1.5rem;
      color: #58a6ff;
      user-select:none;
    }
    /* Table container with vertical scroll */
    .table-wrapper {
      flex-grow: 1;
      overflow-y: auto;
      padding: 1rem 2rem;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 0.9rem;
      color: #c9d1d9;
    }
    thead tr {
      border-bottom: 1px solid #21262d;
      color: #8b949e;
      font-weight: 600;
      user-select:none;
    }
    th, td {
      padding: 0.65rem 0.75rem;
      text-align: left;
      white-space: nowrap;
    }
    th.price, td.price,
    th.change, td.change,
    th.volume, td.volume,
    th.liquidity, td.liquidity,
    th.marketcap, td.marketcap {
      text-align: right;
    }
    tbody tr {
      cursor: pointer;
      border-bottom: 1px solid #21262d;
      transition: background-color 0.2s ease;
    }
    tbody tr:hover {
      background-color: #161b22;
    }
    tbody tr.selected {
      background-color: #21262d;
    }
    /* Change colors */
    td.change.positive {
      color: #3fb950;
      font-weight: 700;
    }
    td.change.negative {
      color: #f85149;
      font-weight: 700;
    }
    /* Sparkline canvas */
    td.sparkline canvas {
      display: block;
      width: 100px;
      height: 24px;
      image-rendering: pixelated;
      border-radius: 3px;
    }
    /* Details panel */
    .details-panel {
      width: 400px;
      background-color: #161b22;
      border-left: 1px solid #21262d;
      padding: 1.5rem 2rem;
      overflow-y: auto;
      user-select:none;
    }
    .details-symbol {
      font-size: 3.5rem;
      font-weight: 700;
      color: #58a6ff;
      margin: 0 0 0.15rem 0;
    }
    .details-name {
      font-weight: 500;
      font-size: 1.25rem;
      color: #8b949e;
      margin: 0 0 1rem 0;
    }
    .details-price {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 1rem;
    }
    .details-change {
      font-weight: 700;
      font-size: 1.25rem;
      margin-bottom: 1rem;
    }
    .details-change.positive {
      color: #3fb950;
    }
    .details-change.negative {
      color: #f85149;
    }
    .details-row {
      margin-bottom: 0.75rem;
      font-size: 0.95rem;
    }
    /* Scrollbar styling */
    .table-wrapper::-webkit-scrollbar,
    .details-panel::-webkit-scrollbar {
      width: 8px;
    }
    .table-wrapper::-webkit-scrollbar-thumb,
    .details-panel::-webkit-scrollbar-thumb {
      background-color: #30363d;
      border-radius: 4px;
    }
    .table-wrapper::-webkit-scrollbar-track,
    .details-panel::-webkit-scrollbar-track {
      background-color: #0d1117;
    }
    /* Responsive */
    @media (max-width: 1000px) {
      #app {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        height: 60px;
        flex-direction: row;
        overflow-x: auto;
        padding: 0 1rem;
        border-right: none;
        border-bottom: 1px solid #21262d;
      }
      .sidebar h2 {
        display: none;
      }
      .sidebar .section,
      .sidebar a {
        flex-shrink: 0;
        margin-right: 1rem;
        padding: 1rem 0.5rem;
      }
      .main-content {
        flex-grow: 1;
        overflow: visible;
      }
      .table-wrapper {
        padding: 0 1rem;
      }
      .details-panel {
        width: 100%;
        border-left: none;
        border-top: 1px solid #21262d;
        padding: 1rem;
        max-height: 200px;
        overflow-x: auto;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
      }
      .details-symbol {
        font-size: 2rem;
        flex-basis: 100%;
        text-align: center;
      }
      .details-name {
        font-size: 1rem;
        flex-basis: 100%;
        text-align: center;
        margin-bottom: 0.5rem;
      }
      .details-price, .details-change {
        flex-basis: 50%;
        text-align: center;
      }
      .details-row {
        flex-basis: 50%;
        text-align: center;
        margin-bottom: 0.3rem;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <nav class="sidebar" aria-label="Sidebar navigation">
      <h2>Dexscreener</h2>
      <div class="section">
        <div class="section-title">Menu</div>
        <a href="#" class="active" tabindex="0">Watchlist</a>
        <a href="#" tabindex="0">Alerts</a>
        <a href="#" tabindex="0">Multicharts</a>
        <a href="#" tabindex="0">New Pairs</a>
        <a href="#" tabindex="0">Gainers & Losers</a>
        <a href="#" tabindex="0">Portfolio</a>
      </div>
      <div class="section">
        <div class="section-title">Chains</div>
        <a href="#" tabindex="0">Ethereum</a>
        <a href="#" tabindex="0">BSC</a>
        <a href="#" tabindex="0">Polygon</a>
        <a href="#" tabindex="0">Avalanche</a>
        <a href="#" tabindex="0">Fantom</a>
        <a href="#" tabindex="0">Arbitrum</a>
        <a href="#" tabindex="0">Optimism</a>
        <a href="#" tabindex="0">Cronos</a>
        <a href="#" tabindex="0">Moonbeam</a>
      </div>
    </nav>
    <main class="main-content" role="main" aria-label="Main content area">
      <header class="header">Trending Tokens</header>
      <section class="table-wrapper" role="region" aria-live="polite">
        <table role="table" aria-label="Trending tokens table">
          <thead>
            <tr>
              <th scope="col">Token</th>
              <th scope="col" class="price">Price</th>
              <th scope="col" class="change">24H %</th>
              <th scope="col" class="volume">Volume</th>
              <th scope="col" class="liquidity">Liquidity</th>
              <th scope="col" class="marketcap">Market Cap</th>
              <th scope="col" class="sparkline">7d</th>
            </tr>
          </thead>
          <tbody id="coin-tbody">
            <tr><td colspan="7" style="text-align:center; padding:2rem;">Loading coins...</td></tr>
          </tbody>
        </table>
      </section>
    </main>
    <aside class="details-panel" role="complementary" aria-label="Token details panel">
      <p style="color:#8b949e; font-size:1.25rem;">Select a token to view details</p>
    </aside>
  </div>

<script>
  const tbody = document.getElementById("coin-tbody");
  const detailsPanel = document.querySelector(".details-panel");
  let coinsData = [];
  let selectedIndex = null;
  let selectedRow = null;
  const refreshInterval = 30000; // 30 seconds

  // Draw sparkline on canvas
  function drawSparkline(canvas, prices) {
    const ctx = canvas.getContext("2d");
    const w = canvas.width;
    const h = canvas.height;
    ctx.clearRect(0, 0, w, h);
    if (!prices || prices.length < 2) return;

    const max = Math.max(...prices);
    const min = Math.min(...prices);
    const range = max - min || 1;

    ctx.strokeStyle = "#58a6ff";
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    prices.forEach((p, i) => {
      const x = (i / (prices.length - 1)) * w;
      const y = h - ((p - min) / range) * h;
      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    ctx.stroke();
  }

  function formatPrice(p) {
    if (p === null || p === undefined) return "-";
    if (p >= 1) return p.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 6});
    else return p.toPrecision(4);
  }
  function formatLargeNum(n) {
    if (n === null || n === undefined) return "-";
    if (n >= 1e12) return (n/1e12).toFixed(2) + "T";
    if (n >= 1e9) return (n/1e9).toFixed(2) + "B";
    if (n >= 1e6) return (n/1e6).toFixed(2) + "M";
    if (n >= 1e3) return (n/1e3).toFixed(2) + "K";
    return n.toFixed(2);
  }
  function formatPercent(p) {
    if (p === null || p === undefined) return "-";
    return (p >= 0 ? "+" : "") + p.toFixed(2) + "%";
  }

  // Render table rows
  function renderTable() {
    tbody.innerHTML = "";
    coinsData.forEach((coin, i) => {
      const tr = document.createElement("tr");
      tr.dataset.index = i;
      if (i === selectedIndex) {
        tr.classList.add("selected");
      }
      // Token cell with icon + name + symbol
      const tdToken = document.createElement("td");
      tdToken.style.display = "flex";
      tdToken.style.alignItems = "center";
      tdToken.style.gap = "0.6rem";

      const img = document.createElement("img");
      img.src = coin.image;
      img.alt = coin.symbol.toUpperCase();
      img.width = 24;
      img.height = 24;
      img.style.borderRadius = "50%";

      const nameSpan = document.createElement("span");
      nameSpan.textContent = coin.name;

      const symbolSpan = document.createElement("span");
      symbolSpan.textContent = coin.symbol.toUpperCase();
      symbolSpan.style.color = "#8b949e";
      symbolSpan.style.fontSize = "0.85rem";

      const nameWrapper = document.createElement("div");
      nameWrapper.style.display = "flex";
      nameWrapper.style.flexDirection = "column";
      nameWrapper.appendChild(nameSpan);
      nameWrapper.appendChild(symbolSpan);

      tdToken.appendChild(img);
      tdToken.appendChild(nameWrapper);

      tr.appendChild(tdToken);

      // Price
      const tdPrice = document.createElement("td");
      tdPrice.className = "price";
      tdPrice.textContent = "$" + formatPrice(coin.current_price);
      tr.appendChild(tdPrice);

      // 24h Change
      const tdChange = document.createElement("td");
      tdChange.className = "change";
      tdChange.textContent = formatPercent(coin.price_change_percentage_24h);
      tdChange.classList.add(coin.price_change_percentage_24h >= 0 ? "positive" : "negative");
      tr.appendChild(tdChange);

      // Volume
      const tdVolume = document.createElement("td");
      tdVolume.className = "volume";
      tdVolume.textContent = "$" + formatLargeNum(coin.total_volume);
      tr.appendChild(tdVolume);

      // Liquidity - using market_cap as proxy
      const tdLiquidity = document.createElement("td");
      tdLiquidity.className = "liquidity";
      tdLiquidity.textContent = "$" + formatLargeNum(coin.market_cap);
      tr.appendChild(tdLiquidity);

      // Market Cap
      const tdMarketCap = document.createElement("td");
      tdMarketCap.className = "marketcap";
      tdMarketCap.textContent = "$" + formatLargeNum(coin.market_cap);
      tr.appendChild(tdMarketCap);

      // Sparkline 7d
      const tdSparkline = document.createElement("td");
      tdSparkline.className = "sparkline";
      const canvas = document.createElement("canvas");
      canvas.width = 100;
      canvas.height = 24;
      tdSparkline.appendChild(canvas);
      tr.appendChild(tdSparkline);

      drawSparkline(canvas, coin.sparkline_in_7d.price);

      tbody.appendChild(tr);

      // Click handler
      tr.onclick = () => {
        if (selectedRow) selectedRow.classList.remove("selected");
        tr.classList.add("selected");
        selectedRow = tr;
        selectedIndex = i;
        renderDetailsPanel(coin);
      }
    });
  }

  function renderDetailsPanel(coin) {
    detailsPanel.innerHTML = "";
    // Symbol & Name
    const symbol = document.createElement("h1");
    symbol.className = "details-symbol";
    symbol.textContent = coin.symbol.toUpperCase();
    const name = document.createElement("p");
    name.className = "details-name";
    name.textContent = coin.name;

    // Price & Change
    const price = document.createElement("p");
    price.className = "details-price";
    price.textContent = "$" + formatPrice(coin.current_price);
    const change = document.createElement("p");
    change.className = "details-change " + (coin.price_change_percentage_24h >= 0 ? "positive" : "negative");
    change.textContent = formatPercent(coin.price_change_percentage_24h);

    // Additional info rows
    function createRow(label, val) {
      const row = document.createElement("div");
      row.className = "details-row";
      row.innerHTML = `<strong>${label}: </strong>${val}`;
      return row;
    }

    const marketCapRow = createRow("Market Cap", "$" + formatLargeNum(coin.market_cap));
    const volumeRow = createRow("24h Volume", "$" + formatLargeNum(coin.total_volume));
    const high24Row = createRow("24h High", "$" + formatPrice(coin.high_24h));
    const low24Row = createRow("24h Low", "$" + formatPrice(coin.low_24h));
    const circulatingSupplyRow = createRow("Circulating Supply", formatLargeNum(coin.circulating_supply));

    // Price chart - canvas sparkline bigger & interactive
    const chartWrapper = document.createElement("div");
    chartWrapper.style.marginTop = "1rem";

    const chartCanvas = document.createElement("canvas");
    chartCanvas.width = 350;
    chartCanvas.height = 100;
    chartCanvas.style.borderRadius = "5px";
    chartWrapper.appendChild(chartCanvas);

    drawLineChart(chartCanvas, coin.sparkline_in_7d.price);

    detailsPanel.appendChild(symbol);
    detailsPanel.appendChild(name);
    detailsPanel.appendChild(price);
    detailsPanel.appendChild(change);
    detailsPanel.appendChild(marketCapRow);
    detailsPanel.appendChild(volumeRow);
    detailsPanel.appendChild(high24Row);
    detailsPanel.appendChild(low24Row);
    detailsPanel.appendChild(circulatingSupplyRow);
    detailsPanel.appendChild(chartWrapper);
  }

  // Draw bigger line chart with axes
  function drawLineChart(canvas, prices) {
    const ctx = canvas.getContext("2d");
    const w = canvas.width;
    const h = canvas.height;
    ctx.clearRect(0, 0, w, h);
    if (!prices || prices.length < 2) return;

    const max = Math.max(...prices);
    const min = Math.min(...prices);
    const range = max - min || 1;

    // Background gradient fill
    const gradient = ctx.createLinearGradient(0, 0, 0, h);
    gradient.addColorStop(0, "rgba(88, 166, 255, 0.3)");
    gradient.addColorStop(1, "rgba(88, 166, 255, 0)");

    ctx.fillStyle = gradient;
    ctx.beginPath();
    prices.forEach((p, i) => {
      const x = (i / (prices.length - 1)) * w;
      const y = h - ((p - min) / range) * h;
      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    ctx.lineTo(w, h);
    ctx.lineTo(0, h);
    ctx.closePath();
    ctx.fill();

    // Stroke line
    ctx.strokeStyle = "#58a6ff";
    ctx.lineWidth = 2;
    ctx.beginPath();
    prices.forEach((p, i) => {
      const x = (i / (prices.length - 1)) * w;
      const y = h - ((p - min) / range) * h;
      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    ctx.stroke();

    // Axes (optional)
    ctx.strokeStyle = "#30363d";
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(0, h);
    ctx.lineTo(w, h);
    ctx.stroke();
  }

  // Fetch coins data from CoinGecko
  async function fetchCoins() {
    try {
      // top 50 coins by market cap with sparkline
      const res = await fetch(
        "https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=50&page=1&sparkline=true&price_change_percentage=24h"
      );
      if (!res.ok) throw new Error("Network error");
      const data = await res.json();
      coinsData = data;
      renderTable();

      // If no selection, select the first coin automatically
      if (selectedIndex === null && coinsData.length > 0) {
        selectedIndex = 0;
        const firstRow = tbody.querySelector("tr");
        if (firstRow) {
          firstRow.classList.add("selected");
          selectedRow = firstRow;
          renderDetailsPanel(coinsData[0]);
        }
      } else if (selectedIndex !== null) {
        // Update details panel with updated data
        renderDetailsPanel(coinsData[selectedIndex]);
      }
    } catch (error) {
      tbody.innerHTML = `<tr><td colspan="7" style="text-align:center; padding:2rem; color:#f85149;">Failed to load data: ${error.message}</td></tr>`;
      detailsPanel.innerHTML = `<p style="color:#f85149;">Failed to load details.</p>`;
      console.error("Fetch coins error:", error);
    }
  }

  // Initial load
  fetchCoins();

  // Auto-refresh every 30s
  setInterval(fetchCoins, refreshInterval);
</script>
</body>
</html>
